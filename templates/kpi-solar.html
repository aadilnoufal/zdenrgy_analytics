{% extends "base.html" %}

{% block title %}Solar Array KPIs{% endblock %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3"></script>
{% endblock %}

{% block content %}
<h1>
	<span>‚òÄÔ∏è Solar Array KPIs</span>
	<a href="/kpi" class="nav-btn">‚Üê Back to KPIs</a>
</h1>

<div class="meta">
	<div class="pill">Real-time Solar Monitoring</div>
	<div class="pill">Refresh: 5s</div>
	<div class="pill">Irradiance: <span id="solar-irradiance-pill">‚Äî</span> W/m¬≤</div>
</div>

<div class="grid">
	<div class="card">
		<h2>Solar Generation</h2>
		<div class="kpi-value-large">
			<span id="solar-generation">‚Äî</span>
			<span class="unit">kW</span>
		</div>
		<div class="kpi-subtitle">Current power output</div>
	</div>

	<div class="card">
		<h2>Daily Solar Energy</h2>
		<div class="kpi-value-large">
			<span id="solar-daily-energy">‚Äî</span>
			<span class="unit">kWh</span>
		</div>
		<div class="kpi-subtitle">Energy generated today</div>
	</div>

	<div class="card">
		<h2>Performance Ratio</h2>
		<div class="kpi-value-large">
			<span id="solar-performance">‚Äî</span>
			<span class="unit">%</span>
		</div>
		<div class="kpi-subtitle">Actual vs theoretical</div>
	</div>

	<div class="card">
		<h2>Cost Savings (Today)</h2>
		<div class="kpi-value-large">
			<span id="solar-savings">‚Äî</span>
			<span class="unit">$</span>
		</div>
		<div class="kpi-subtitle">Money saved</div>
	</div>
</div>

<div class="grid-2x2" style="margin-top: 1.5rem;">
	<div class="card">
		<h2>Solar Irradiance</h2>
		<div class="chart-container">
			<canvas id="chart-irradiance"></canvas>
		</div>
	</div>

	<div class="card">
		<h2>Solar Generation</h2>
		<div class="chart-container">
			<canvas id="chart-generation"></canvas>
		</div>
	</div>
</div>

<div class="card" style="margin-top: 1.5rem;">
	<h2>Solar Array Configuration</h2>
	<table>
		<thead>
			<tr>
				<th>Parameter</th>
				<th>Value</th>
				<th>Unit</th>
			</tr>
		</thead>
		<tbody id="solar-config">
			<tr>
				<td colspan="3" style="text-align: center; opacity: 0.5;">Loading...</td>
			</tr>
		</tbody>
	</table>
</div>

<div class="card" style="margin-top: 1.5rem;">
	<h2>Environmental Impact</h2>
	<div class="grid">
		<div class="card" style="background: #1a1d23; border: none;">
			<h2 style="font-size: 0.9rem; opacity: 0.8;">Carbon Offset (Today)</h2>
			<div class="kpi-value-large">
				<span id="solar-carbon">‚Äî</span>
				<span class="unit" style="font-size: 1.2rem;">kg CO‚ÇÇ</span>
			</div>
		</div>
		<div class="card" style="background: #1a1d23; border: none;">
			<h2 style="font-size: 0.9rem; opacity: 0.8;">Trees Equivalent</h2>
			<div class="kpi-value-large">
				<span id="solar-trees">‚Äî</span>
				<span class="unit" style="font-size: 1.2rem;">trees</span>
			</div>
		</div>
	</div>
</div>

<!-- Solar Panel Cleaning Recommendations -->
<div class="card" style="margin-top: 1.5rem;">
	<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
		<h2>üßπ Panel Cleaning Recommendations</h2>
		<button id="record-cleaning-btn" class="nav-btn" style="font-size: 0.9rem;">Record Cleaning</button>
	</div>
	
	<div id="cleaning-status" class="cleaning-status-card">
		<div class="loading">Loading cleaning data...</div>
	</div>
	
	<div id="cleaning-history-section" style="margin-top: 1.5rem;">
		<h3 style="font-size: 1rem; opacity: 0.9; margin-bottom: 0.5rem;">Recent Cleaning History</h3>
		<table style="font-size: 0.85rem;">
			<thead>
				<tr>
					<th>Date</th>
					<th>Days Ago</th>
					<th>Baseline Ratio</th>
					<th>Notes</th>
				</tr>
			</thead>
			<tbody id="cleaning-history">
				<tr>
					<td colspan="4" style="text-align: center; opacity: 0.5;">No cleaning records yet</td>
				</tr>
			</tbody>
		</table>
	</div>
</div>

<!-- Record Cleaning Modal -->
<div class="modal" id="cleaning-modal" onclick="closeCleaningModal(event)">
	<div class="modal-content" onclick="event.stopPropagation()">
		<div class="modal-header">
			<h2>Record Panel Cleaning</h2>
			<button class="modal-close" onclick="closeCleaningModal()">&times;</button>
		</div>
		<div class="modal-body">
			<form id="cleaning-form" style="display: flex; flex-direction: column; gap: 1rem;">
				<div>
					<label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Cleaning Date</label>
					<input type="date" id="cleaning-date" class="date-input" style="width: 100%;" required>
				</div>
				<div>
					<label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Notes (optional)</label>
					<textarea id="cleaning-notes" rows="3" style="width: 100%; background: #2d3341; color: #eee; border: 1px solid #3a4150; border-radius: 8px; padding: 0.6rem; font-family: inherit;"></textarea>
				</div>
				<div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
					<button type="submit" class="export-btn" style="flex: 1;">Record Cleaning</button>
					<button type="button" onclick="closeCleaningModal()" class="nav-btn" style="flex: 1;">Cancel</button>
				</div>
			</form>
		</div>
	</div>
</div>

<footer>Solar data updates every 5 seconds. Configure solar parameters in config.py</footer>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/kpi-solar.js') }}"></script>
{% endblock %}
